<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>颜色管理工具</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .color-preview {
            width: 100%;
            height: 60px;
            border-radius: 5px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
        }

        .color-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .color-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .color-swatch {
            width: 100%;
            height: 100px;
            border-radius: 5px 5px 0 0;
        }

        .group-badge {
            cursor: pointer;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .nav-tabs .nav-link.active {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container-fluid py-4">
        <h1 class="text-center mb-4">颜色管理工具</h1>

        <div class="row">
            <!-- 颜色输入部分 -->
            <div class="col-lg-4 mb-4">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">颜色输入</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs mb-3" id="colorInputTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="rgb-tab" data-bs-toggle="tab" data-bs-target="#rgb"
                                    type="button" role="tab">RGB</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="hex-tab" data-bs-toggle="tab" data-bs-target="#hex"
                                    type="button" role="tab">HEX</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="picker-tab" data-bs-toggle="tab" data-bs-target="#picker"
                                    type="button" role="tab">拾色器</button>
                            </li>
                        </ul>

                        <div class="tab-content" id="colorInputTabsContent">
                            <!-- RGB 输入 -->
                            <div class="tab-pane fade show active" id="rgb" role="tabpanel">
                                <div class="mb-3">
                                    <label for="redInput" class="form-label">红色 (0-255)</label>
                                    <input type="number" class="form-control" id="redInput" min="0" max="255"
                                        value="128">
                                </div>
                                <div class="mb-3">
                                    <label for="greenInput" class="form-label">绿色 (0-255)</label>
                                    <input type="number" class="form-control" id="greenInput" min="0" max="255"
                                        value="128">
                                </div>
                                <div class="mb-3">
                                    <label for="blueInput" class="form-label">蓝色 (0-255)</label>
                                    <input type="number" class="form-control" id="blueInput" min="0" max="255"
                                        value="128">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">颜色预览</label>
                                    <div class="color-preview" id="rgbPreview"></div>
                                </div>
                                <button class="btn btn-primary w-100" id="applyRgb">应用颜色</button>
                            </div>

                            <!-- HEX 输入 -->
                            <div class="tab-pane fade" id="hex" role="tabpanel">
                                <div class="mb-3">
                                    <label for="hexInput" class="form-label">HEX 颜色值</label>
                                    <div class="input-group">
                                        <span class="input-group-text">#</span>
                                        <input type="text" class="form-control" id="hexInput" value="808080"
                                            maxlength="6">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">颜色预览</label>
                                    <div class="color-preview" id="hexPreview"></div>
                                </div>
                                <button class="btn btn-primary w-100" id="applyHex">应用颜色</button>
                            </div>

                            <!-- 颜色拾取器 -->
                            <div class="tab-pane fade" id="picker" role="tabpanel">
                                <div class="mb-3">
                                    <label for="colorPicker" class="form-label">选择颜色</label>
                                    <input type="color" class="form-control form-control-color" id="colorPicker"
                                        value="#808080">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">颜色预览</label>
                                    <div class="color-preview" id="pickerPreview"></div>
                                </div>
                                <button class="btn btn-primary w-100" id="applyPicker">应用颜色</button>
                            </div>
                        </div>

                        <hr>

                        <!-- 颜色信息显示 -->
                        <div class="mt-3">
                            <h5>颜色信息</h5>
                            <div class="mb-2">
                                <strong>RGB:</strong> <span id="rgbValue">rgb(128, 128, 128)</span>
                            </div>
                            <div class="mb-2">
                                <strong>HEX:</strong> <span id="hexValue">#808080</span>
                            </div>
                            <div class="mb-2">
                                <strong>十进制:</strong> <span id="decimalValue">8421504</span>
                            </div>
                        </div>

                        <hr>

                        <!-- 添加到分组 -->
                        <div class="mt-3">
                            <h5>添加到分组</h5>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="groupNameInput" placeholder="输入分组名称">
                                <button class="btn btn-outline-secondary" type="button" id="addToGroupBtn">添加</button>
                            </div>
                            <div id="groupTags" class="mb-3">
                                <!-- 分组标签将在这里动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 颜色管理部分 -->
            <div class="col-lg-8">
                <div class="card shadow-sm">
                    <div class="card-header bg-success text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">颜色管理</h5>
                            <button class="btn btn-sm btn-light" id="clearAllBtn">清空所有</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- 分组筛选 -->
                        <div class="mb-4">
                            <h6>筛选分组</h6>
                            <div id="groupFilter">
                                <span class="badge bg-secondary group-badge active" data-group="all">全部</span>
                                <!-- 分组筛选标签将在这里动态生成 -->
                            </div>
                        </div>

                        <!-- 颜色列表 -->
                        <div class="row" id="colorList">
                            <!-- 颜色卡片将在这里动态生成 -->
                            <div class="col-12 text-center py-5" id="emptyMessage">
                                <i class="fas fa-palette fa-3x text-muted mb-3"></i>
                                <p class="text-muted">暂无颜色，请添加颜色</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑颜色模态框 -->
    <div class="modal fade" id="editColorModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">编辑颜色</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">颜色预览</label>
                        <div class="color-preview" id="editColorPreview"></div>
                    </div>
                    <div class="mb-3">
                        <label for="editColorName" class="form-label">颜色名称</label>
                        <input type="text" class="form-control" id="editColorName">
                    </div>
                    <div class="mb-3">
                        <label for="editColorGroups" class="form-label">分组</label>
                        <input type="text" class="form-control" id="editColorGroups" placeholder="用逗号分隔多个分组">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="saveEditColorBtn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS 和依赖 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 存储颜色数据
        let colors = JSON.parse(localStorage.getItem('colors')) || [];
        let currentColor = {
            rgb: { r: 128, g: 128, b: 128 },
            hex: '#808080',
            decimal: 8421504,
            name: '',
            groups: []
        };

        // DOM 加载完成后初始化
        document.addEventListener('DOMContentLoaded', function () {
            initColorInputs();
            updateColorInfo();
            renderColorList();
            renderGroupFilter();

            // 绑定事件
            document.getElementById('applyRgb').addEventListener('click', applyRgbColor);
            document.getElementById('applyHex').addEventListener('click', applyHexColor);
            document.getElementById('applyPicker').addEventListener('click', applyPickerColor);
            document.getElementById('addToGroupBtn').addEventListener('click', addCurrentColorToGroup);
            document.getElementById('clearAllBtn').addEventListener('click', clearAllColors);
            document.getElementById('saveEditColorBtn').addEventListener('click', saveEditedColor);

            // 从拾色器更新预览
            document.getElementById('colorPicker').addEventListener('input', function () {
                const hex = this.value;
                document.getElementById('pickerPreview').style.backgroundColor = hex;
            });

            // 绑定复制按钮事件（使用事件委托）
            document.addEventListener('click', function (e) {
                if (e.target.closest('.copy-btn')) {
                    const button = e.target.closest('.copy-btn');
                    const value = button.getAttribute('data-value');
                    copyToClipboard(value);

                    // 显示复制成功的反馈
                    const originalTitle = button.getAttribute('title');
                    button.setAttribute('title', '已复制!');
                    button.querySelector('i').className = 'fas fa-check';

                    setTimeout(() => {
                        button.setAttribute('title', originalTitle);
                        button.querySelector('i').className = 'fas fa-copy';
                    }, 2000);
                }
            });
        });

        // 添加复制到剪贴板的函数
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';  // 防止页面滚动
            document.body.appendChild(textarea);
            textarea.select();

            try {
                document.execCommand('copy');
            } catch (err) {
                console.error('复制失败:', err);
            }

            document.body.removeChild(textarea);
        }

        // 初始化颜色输入
        function initColorInputs() {
            // 设置初始预览颜色
            document.getElementById('rgbPreview').style.backgroundColor = `rgb(${currentColor.rgb.r}, ${currentColor.rgb.g}, ${currentColor.rgb.b})`;
            document.getElementById('hexPreview').style.backgroundColor = currentColor.hex;
            document.getElementById('pickerPreview').style.backgroundColor = currentColor.hex;

            // RGB 输入变化时更新预览
            ['redInput', 'greenInput', 'blueInput'].forEach(id => {
                document.getElementById(id).addEventListener('input', function () {
                    const r = parseInt(document.getElementById('redInput').value) || 0;
                    const g = parseInt(document.getElementById('greenInput').value) || 0;
                    const b = parseInt(document.getElementById('blueInput').value) || 0;
                    document.getElementById('rgbPreview').style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
                });
            });

            // HEX 输入变化时更新预览
            document.getElementById('hexInput').addEventListener('input', function () {
                const hex = '#' + this.value;
                if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
                    document.getElementById('hexPreview').style.backgroundColor = hex;
                }
            });
        }

        // 应用 RGB 颜色
        function applyRgbColor() {
            const r = Math.min(255, Math.max(0, parseInt(document.getElementById('redInput').value) || 0));
            const g = Math.min(255, Math.max(0, parseInt(document.getElementById('greenInput').value) || 0));
            const b = Math.min(255, Math.max(0, parseInt(document.getElementById('blueInput').value) || 0));

            currentColor = {
                rgb: { r, g, b },
                hex: rgbToHex(r, g, b),
                decimal: rgbToDecimal(r, g, b),
                name: '',
                groups: []
            };

            updateColorInfo();
            updateColorInputs();
            updateBackgroundColor();
        }

        // 应用 HEX 颜色
        function applyHexColor() {
            let hex = document.getElementById('hexInput').value;
            if (!hex.startsWith('#')) hex = '#' + hex;

            if (/^#[0-9A-Fa-f]{6}$/.test(hex)) {
                const rgb = hexToRgb(hex);
                currentColor = {
                    rgb,
                    hex,
                    decimal: rgbToDecimal(rgb.r, rgb.g, rgb.b),
                    name: '',
                    groups: []
                };

                updateColorInfo();
                updateColorInputs();
                updateBackgroundColor();
            } else {
                alert('请输入有效的 HEX 颜色值 (如 FF0000 或 #FF0000)');
            }
        }

        // 应用拾色器颜色
        function applyPickerColor() {
            const hex = document.getElementById('colorPicker').value;
            const rgb = hexToRgb(hex);

            currentColor = {
                rgb,
                hex,
                decimal: rgbToDecimal(rgb.r, rgb.g, rgb.b),
                name: '',
                groups: []
            };

            updateColorInfo();
            updateColorInputs();
            updateBackgroundColor();
        }

        // 更新颜色信息显示
        function updateColorInfo() {
            document.getElementById('rgbValue').textContent = `rgb(${currentColor.rgb.r}, ${currentColor.rgb.g}, ${currentColor.rgb.b})`;
            document.getElementById('hexValue').textContent = currentColor.hex;
            document.getElementById('decimalValue').textContent = currentColor.decimal;
        }

        // 更新输入控件以反映当前颜色
        function updateColorInputs() {
            document.getElementById('redInput').value = currentColor.rgb.r;
            document.getElementById('greenInput').value = currentColor.rgb.g;
            document.getElementById('blueInput').value = currentColor.rgb.b;

            document.getElementById('hexInput').value = currentColor.hex.substring(1);
            document.getElementById('colorPicker').value = currentColor.hex;

            document.getElementById('rgbPreview').style.backgroundColor = `rgb(${currentColor.rgb.r}, ${currentColor.rgb.g}, ${currentColor.rgb.b})`;
            document.getElementById('hexPreview').style.backgroundColor = currentColor.hex;
            document.getElementById('pickerPreview').style.backgroundColor = currentColor.hex;
        }

        // 更新背景颜色
        function updateBackgroundColor() {
            document.body.style.backgroundColor = currentColor.hex;
        }

        // 添加当前颜色到分组
        function addCurrentColorToGroup() {
            const groupName = document.getElementById('groupNameInput').value.trim();
            if (!groupName) return;

            // 添加到当前颜色的分组
            if (!currentColor.groups.includes(groupName)) {
                currentColor.groups.push(groupName);
            }

            // 添加到颜色列表
            const colorWithName = {
                ...currentColor,
                name: groupName + ' ' + (colors.filter(c => c.groups.includes(groupName)).length + 1)
            };
            colors.push(colorWithName);
            saveColors();

            // 清空输入
            document.getElementById('groupNameInput').value = '';

            // 更新UI
            renderGroupTags();
            renderColorList();
            renderGroupFilter();

            // 显示成功消息
            const toast = document.createElement('div');
            toast.className = 'position-fixed bottom-0 end-0 p-3';
            toast.style.zIndex = '11';
            toast.innerHTML = `
                <div class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header">
                        <strong class="me-auto">成功</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        颜色已添加到分组 "${groupName}"
                    </div>
                </div>
            `;
            document.body.appendChild(toast);

            // 3秒后自动移除
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // 渲染分组标签
        function renderGroupTags() {
            const container = document.getElementById('groupTags');
            container.innerHTML = '';

            currentColor.groups.forEach(group => {
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary me-2 mb-2';
                badge.textContent = group;
                container.appendChild(badge);
            });
        }

        // 渲染颜色列表
        // function renderColorList(filterGroup = 'all') {
        //     const container = document.getElementById('colorList');
        //     const emptyMessage = document.getElementById('emptyMessage');

        //     // 过滤颜色
        //     let filteredColors = colors;
        //     if (filterGroup !== 'all') {
        //         filteredColors = colors.filter(color => color.groups.includes(filterGroup));
        //     }

        //     if (filteredColors.length === 0) {
        //         container.innerHTML = '<div class="col-12 text-center py-5" id="emptyMessage"><i class="fas fa-palette fa-3x text-muted mb-3"></i><p class="text-muted">暂无颜色，请添加颜色</p></div>';
        //         return;
        //     }

        //     container.innerHTML = '';

        //     filteredColors.forEach((color, index) => {
        //         const col = document.createElement('div');
        //         col.className = 'col-md-4 col-sm-6 mb-4';

        //         col.innerHTML = `
        //             <div class="card color-card h-100">
        //                 <div class="color-swatch" style="background-color: ${color.hex};"></div>
        //                 <div class="card-body">
        //                     <h6 class="card-title">${color.name || '未命名颜色'}</h6>
        //                     <p class="card-text small mb-1">HEX: ${color.hex}</p>
        //                     <p class="card-text small mb-1">RGB: ${color.rgb.r}, ${color.rgb.g}, ${color.rgb.b}</p>
        //                     <div class="mt-2">
        //                         ${color.groups.map(group => `<span class="badge bg-secondary me-1">${group}</span>`).join('')}
        //                     </div>
        //                 </div>
        //                 <div class="card-footer bg-transparent border-top-0">
        //                     <button class="btn btn-sm btn-outline-primary edit-btn" data-index="${index}">
        //                         <i class="fas fa-edit"></i>
        //                     </button>
        //                     <button class="btn btn-sm btn-outline-danger float-end delete-btn" data-index="${index}">
        //                         <i class="fas fa-trash"></i>
        //                     </button>
        //                 </div>
        //             </div>
        //         `;

        //         container.appendChild(col);
        //     });

        //     // 绑定编辑和删除按钮事件
        //     document.querySelectorAll('.edit-btn').forEach(btn => {
        //         btn.addEventListener('click', function () {
        //             const index = parseInt(this.getAttribute('data-index'));
        //             openEditModal(index);
        //         });
        //     });

        //     document.querySelectorAll('.delete-btn').forEach(btn => {
        //         btn.addEventListener('click', function () {
        //             const index = parseInt(this.getAttribute('data-index'));
        //             deleteColor(index);
        //         });
        //     });
        // }

        // 渲染颜色列表
        // function renderColorList(filterGroup = 'all') {
        //     const container = document.getElementById('colorList');
        //     const emptyMessage = document.getElementById('emptyMessage');

        //     // 过滤颜色，同时保留原始索引
        //     let filteredColors = colors.map((color, originalIndex) => ({ color, originalIndex }));
        //     if (filterGroup !== 'all') {
        //         filteredColors = filteredColors.filter(({ color }) => color.groups.includes(filterGroup));
        //     }

        //     if (filteredColors.length === 0) {
        //         container.innerHTML = '<div class="col-12 text-center py-5" id="emptyMessage"><i class="fas fa-palette fa-3x text-muted mb-3"></i><p class="text-muted">暂无颜色，请添加颜色</p></div>';
        //         return;
        //     }

        //     container.innerHTML = '';

        //     filteredColors.forEach(({ color, originalIndex }) => {
        //         const col = document.createElement('div');
        //         col.className = 'col-md-4 col-sm-6 mb-4';

        //         col.innerHTML = `
        //     <div class="card color-card h-100">
        //         <div class="color-swatch" style="background-color: ${color.hex};"></div>
        //         <div class="card-body">
        //             <h6 class="card-title">${color.name || '未命名颜色'}</h6>
        //             <p class="card-text small mb-1">HEX: ${color.hex}</p>
        //             <p class="card-text small mb-1">RGB: ${color.rgb.r}, ${color.rgb.g}, ${color.rgb.b}</p>
        //             <div class="mt-2">
        //                 ${color.groups.map(group => `<span class="badge bg-secondary me-1">${group}</span>`).join('')}
        //             </div>
        //         </div>
        //         <div class="card-footer bg-transparent border-top-0">
        //             <button class="btn btn-sm btn-outline-primary edit-btn" data-index="${originalIndex}">
        //                 <i class="fas fa-edit"></i>
        //             </button>
        //             <button class="btn btn-sm btn-outline-danger float-end delete-btn" data-index="${originalIndex}">
        //                 <i class="fas fa-trash"></i>
        //             </button>
        //         </div>
        //     </div>
        // `;

        //         container.appendChild(col);
        //     });

        //     // 绑定编辑和删除按钮事件
        //     document.querySelectorAll('.edit-btn').forEach(btn => {
        //         btn.addEventListener('click', function () {
        //             const index = parseInt(this.getAttribute('data-index'));
        //             openEditModal(index);
        //         });
        //     });

        //     document.querySelectorAll('.delete-btn').forEach(btn => {
        //         btn.addEventListener('click', function () {
        //             const index = parseInt(this.getAttribute('data-index'));
        //             deleteColor(index);
        //         });
        //     });
        // }

        // 渲染颜色列表
        function renderColorList(filterGroup = 'all') {
            const container = document.getElementById('colorList');
            const emptyMessage = document.getElementById('emptyMessage');

            // 过滤颜色，同时保留原始索引
            let filteredColors = colors.map((color, originalIndex) => ({ color, originalIndex }));
            if (filterGroup !== 'all') {
                filteredColors = filteredColors.filter(({ color }) => color.groups.includes(filterGroup));
            }

            if (filteredColors.length === 0) {
                container.innerHTML = '<div class="col-12 text-center py-5" id="emptyMessage"><i class="fas fa-palette fa-3x text-muted mb-3"></i><p class="text-muted">暂无颜色，请添加颜色</p></div>';
                return;
            }

            container.innerHTML = '';

            filteredColors.forEach(({ color, originalIndex }) => {
                const col = document.createElement('div');
                col.className = 'col-md-4 col-sm-6 mb-4';

                col.innerHTML = `
            <div class="card color-card h-100">
                <div class="color-swatch" style="background-color: ${color.hex};"></div>
                <div class="card-body">
                    <h6 class="card-title">${color.name || '未命名颜色'}</h6>
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span class="small">HEX: ${color.hex}</span>
                        <button class="btn btn-sm btn-outline-secondary copy-btn" data-value="${color.hex}" title="复制HEX值">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span class="small">RGB: ${color.rgb.r}, ${color.rgb.g}, ${color.rgb.b}</span>
                        <button class="btn btn-sm btn-outline-secondary copy-btn" data-value="rgb(${color.rgb.r}, ${color.rgb.g}, ${color.rgb.b})" title="复制RGB值">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="mt-2">
                        ${color.groups.map(group => `<span class="badge bg-secondary me-1">${group}</span>`).join('')}
                    </div>
                </div>
                <div class="card-footer bg-transparent border-top-0">
                    <button class="btn btn-sm btn-outline-primary edit-btn" data-index="${originalIndex}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger float-end delete-btn" data-index="${originalIndex}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;

                container.appendChild(col);
            });

            // 绑定编辑和删除按钮事件
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const index = parseInt(this.getAttribute('data-index'));
                    openEditModal(index);
                });
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const index = parseInt(this.getAttribute('data-index'));
                    deleteColor(index);
                });
            });
        }

        // 渲染分组筛选器
        function renderGroupFilter() {
            const container = document.getElementById('groupFilter');

            // 获取所有唯一的分组
            const allGroups = new Set();
            colors.forEach(color => {
                color.groups.forEach(group => allGroups.add(group));
            });

            // 清空容器，保留"全部"按钮
            container.innerHTML = '<span class="badge bg-secondary group-badge active" data-group="all">全部</span>';

            // 添加分组按钮
            allGroups.forEach(group => {
                const badge = document.createElement('span');
                badge.className = 'badge bg-primary group-badge';
                badge.textContent = group;
                badge.setAttribute('data-group', group);
                container.appendChild(badge);
            });

            // 绑定点击事件
            document.querySelectorAll('.group-badge').forEach(badge => {
                badge.addEventListener('click', function () {
                    const group = this.getAttribute('data-group');

                    // 更新活动状态
                    document.querySelectorAll('.group-badge').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // 过滤颜色列表
                    renderColorList(group);
                });
            });
        }

        // 打开编辑模态框
        function openEditModal(index) {
            const color = colors[index];
            const modal = new bootstrap.Modal(document.getElementById('editColorModal'));

            // 设置模态框内容
            document.getElementById('editColorPreview').style.backgroundColor = color.hex;
            document.getElementById('editColorName').value = color.name || '';
            document.getElementById('editColorGroups').value = color.groups.join(', ');

            // 存储当前编辑的索引
            document.getElementById('editColorModal').setAttribute('data-edit-index', index);

            // 显示模态框
            modal.show();
        }

        // 保存编辑的颜色
        function saveEditedColor() {
            const index = parseInt(document.getElementById('editColorModal').getAttribute('data-edit-index'));
            const name = document.getElementById('editColorName').value.trim();
            const groups = document.getElementById('editColorGroups').value
                .split(',')
                .map(g => g.trim())
                .filter(g => g);

            // 更新颜色
            colors[index].name = name;
            colors[index].groups = groups;
            saveColors();

            // 关闭模态框
            const modal = bootstrap.Modal.getInstance(document.getElementById('editColorModal'));
            modal.hide();

            // 重新渲染列表和分组
            renderColorList();
            renderGroupFilter();
        }

        // 删除颜色
        function deleteColor(index) {
            if (confirm('确定要删除这个颜色吗？')) {
                colors.splice(index, 1);
                saveColors();
                renderColorList();
                renderGroupFilter();
            }
        }

        // 清空所有颜色
        function clearAllColors() {
            if (confirm('确定要清空所有颜色吗？此操作不可撤销！')) {
                colors = [];
                saveColors();
                renderColorList();
                renderGroupFilter();
            }
        }

        // 保存颜色到本地存储
        function saveColors() {
            localStorage.setItem('colors', JSON.stringify(colors));
        }

        // 颜色转换辅助函数
        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => {
                const hex = x.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            }).join('');
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 0, g: 0, b: 0 };
        }

        function rgbToDecimal(r, g, b) {
            return (r << 16) + (g << 8) + b;
        }
    </script>
</body>

</html>